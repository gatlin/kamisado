!function(){"use strict";function a(a,b){return b>a?a:b}function b(){var a=location.hash.slice(1);return""===a&&(a=u(),location.hash="#"+a),a}function c(a,b){this.x=a,this.y=b}function d(a,b){var d=a.getBoundingClientRect();return new c(b.clientX-d.left,b.clientY-d.top)}function e(a,b,c,d,e){this.grid=a,this.pos=b,this.selected="undefined"!=typeof d?d:null,this.player="undefined"!=typeof e?e:0,this.gameId="undefined"!=typeof c?c:"test-game"}function f(a){var b=a.extract(),c=s[t[a.pos.y][a.pos.x]];if(o.fillStyle=c,o.fillRect(a.pos.x*j,a.pos.y*j,j,j),0===b)return b;var d=a.pos.x+1,e=a.pos.y+1,f={x:d*j-j/2,y:e*j-j/2},g=b>r?s[9]:s[8],h=s[(b-1)%8];return o.beginPath(),o.arc(f.x,f.y,k,0,2*Math.PI,!1),o.closePath(),o.fillStyle=g,o.fill(),o.strokeStyle=g,o.stroke(),o.beginPath(),o.arc(f.x,f.y,.75*k,0,2*Math.PI,!1),o.closePath(),o.fillStyle=h,o.fill(),o.strokeStyle=h,o.stroke(),null!==a.selected&&a.selected.x===a.pos.x&&a.selected.y===a.pos.y&&(o.beginPath(),o.arc(f.x,f.y,.5*k,0,2*Math.PI,!1),o.fillStyle=g,o.fill(),o.strokeStyle=g,o.stroke()),b}function g(a){this.unsafePerformIO=a}function h(){return new g(function(){var a=b(),d=JSON.parse(localStorage.getItem(a));if(null===d){var f,g=[];for(f=1;r-1>f;f++)g[f]=[].repeat(0,8);return g[0]=[1,2,3,4,5,6,7,8],g[7]=[16,15,14,13,12,11,10,9],new e(g,new c(0,0),a)}return new e(d.grid,new c(0,0),d.gameId,d.selected,d.player)})}function i(a){return new g(function(){o.canvas.addEventListener("click",function(b){var c=d(this,b);c.x=Math.floor(c.x/j),c.y=Math.floor(c.y/j),a.clicked(c).drawCells()}),document.getElementById("new-game").addEventListener("click",function(){console.log("clicked new game"),location.hash="",location.reload()})})}var j,k,l,m,n=document.getElementById("board"),o=n.getElementsByTagName("canvas")[0].getContext("2d"),p=window.innerWidth,q=window.innerHeight-50,r=8,s=["#F5B437","#3340AE","#1E8AD1","#F8D6C4","#F6E500","#DC442F","#BAD360","#6B451E","#080D07","#F4FFF4"],t=[[0,1,2,3,4,5,6,7],[5,0,3,6,1,4,7,2],[6,3,0,5,2,7,4,1],[3,2,1,0,7,6,5,4],[4,5,6,7,0,1,2,3],[1,4,7,2,5,0,3,6],[2,7,4,1,6,3,0,5],[7,6,5,4,3,2,1,0]];Array.prototype.repeat=function(a,b){for(;b;)this[--b]=a;return this};var u=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();e.prototype.save=function(){var a={grid:this.grid,player:this.player,gameId:this.gameId,selected:this.selected};localStorage.setItem(this.gameId,JSON.stringify(a)),console.log("saved as gameId = "+this.gameId)},e.prototype.updatePos=function(a){return this.pos=a,this},e.prototype.extract=function(){return this.grid[this.pos.y][this.pos.x]},e.prototype.extend=function(a){var b,d,f=[];for(d=0;d<this.grid.length;d++)for(f[d]=[],b=0;b<this.grid[d].length;b++)f[d][b]=a(new e(this.grid,new c(b,d),this.gameId,this.selected,this.player));return this.grid=f,this},e.prototype.drawCells=function(){return this.extend(f)},e.prototype.legalMove=function(){return(this.player?this.selected.y>this.pos.y:this.selected.y<this.pos.y)&&0===this.extract()&&(Math.abs(this.selected.x-this.pos.x)===Math.abs(this.selected.y-this.pos.y)||this.selected.x-this.pos.x===0)},e.prototype.clicked=function(a){var b=this.updatePos(a).extract();if(console.log("Clicked: x = "+this.pos.x+", y = "+this.pos.y),console.log(this.extract()),null===this.selected&&(this.selected=new c(-1,-1)),this.selected.x===this.pos.x&&this.selected.y===this.pos.y)return this.player=this.player?0:1,this.selectNextPiece(),this;if(b>0&&(this.selected=this.pos),0===b){if(!this.legalMove())return this;this.grid[this.pos.y][this.pos.x]=this.grid[this.selected.y][this.selected.x],this.grid[this.selected.y][this.selected.x]=0,this.selected.x=this.pos.x,this.selected.y=this.pos.y,this.player=this.player?0:1,console.log("moved. switched to player "+this.player)}return this.selectNextPiece(),this.save(),this},e.prototype.selectNextPiece=function(){var a,b,c,d=t[this.selected.y][this.selected.x],e=d+1+8*this.player;for(b=0;b<this.grid.length;b++)for(a=0;a<this.grid[b].length;a++)if(c=this.grid[b][a],c===e){this.selected.x=a,this.selected.y=b;break}},g.of=function(a){return new g(function(){return a})},g.prototype.chain=function(a){var b=this;return new g(function(){return a(b.unsafePerformIO()).unsafePerformIO()})},g.prototype.fork=function(){var a=this;return new g(function(){setTimeout(function(){a.unsafePerformIO()},0)})},l=new g(function(){o.canvas.width=.9*a(p,q),o.canvas.height=o.canvas.width,j=.9*a(p,q)/r,k=.9*j/2}),m=l.chain(h).chain(function(a){return new g.of(a.drawCells())}).chain(i),m.unsafePerformIO()}();