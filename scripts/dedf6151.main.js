"use strict";function min(a,b){return b>a?a:b}function supportsLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function getMousePos(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function Session(){location.hash.length>0?this.gameId=location.hash:(this.gameId=guid(),location.hash=this.gameId,this.state=this.initialState(),this.save()),this.load(),console.log(this.gameId)}function Board(a,b){this.elem=document.getElementById(a),this.ctx=this.elem.getElementsByTagName("canvas")[0].getContext("2d"),this.tileColor=[["orange","blue","sky","pink","yellow","red","green","brown"],["red","orange","pink","green","blue","yellow","brown","sky"],["green","pink","orange","red","sky","brown","yellow","blue"],["pink","sky","blue","orange","brown","green","red","yellow"],["yellow","red","green","brown","orange","blue","sky","pink"],["blue","yellow","brown","sky","red","orange","pink","green"],["sky","brown","yellow","blue","green","pink","orange","red"],["brown","green","red","yellow","pink","sky","blue","orange"]],this.session=b;var c=window.innerWidth,d=window.innerHeight;this.ctx.canvas.width=.9*min(d,c),this.ctx.canvas.height=this.ctx.canvas.width,this.tileSide=.9*min(d,c)/8}function init(){return supportsLocalStorage()?(theBoard=new Board("board",new Session),theBoard.addContextEvent("click",function(a){var b=getMousePos(this,a);theBoard.clicked(b),theBoard.draw()},!1),document.getElementById("reset").addEventListener("click",function(){theBoard.resetGame()}),void theBoard.draw()):void console.log("localStorage is required to play this game.")}var theBoard;Array.prototype.repeat=function(a,b){for(;b;)this[--b]=a;return this};var guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),colors={orange:"#F5B437",blue:"#3340AE",sky:"#1E8AD1",pink:"#F8D6C4",yellow:"#F6E500",red:"#DC442F",green:"#BAD360",brown:"#6B451E",player1:"#080D07",player2:"#F4FFF4"},pieceNumberColors=["orange","blue","sky","pink","yellow","red","green","brown"];Session.prototype.load=function(){this.state=JSON.parse(localStorage.getItem(this.gameId)),null===this.state&&(this.state=this.initialState(),this.save())},Session.prototype.save=function(){localStorage.setItem(this.gameId,JSON.stringify(this.state))},Session.prototype.whoami=function(){return 1},Session.prototype.initialState=function(){for(var a=new Array(8),b=1;7>b;b++)a[b]=[].repeat(0,8);a[0]=[1,2,3,4,5,6,7,8],a[7]=[16,15,14,13,12,11,10,9];var c={grid:a,selected:{x:-1,y:-1},whoAmI:this.whoami(),whoseTurn:1};return c},Session.prototype.resetGame=function(){this.state=this.initialState(),this.save()},Board.prototype.getContext=function(){return this.ctx},Board.prototype.draw=function(){for(var a=0;8>a;a++)for(var b=0;8>b;b++){var c=colors[this.tileColor[b][a]];this.ctx.fillStyle=c,this.ctx.fillRect(a*this.tileSide,b*this.tileSide,this.tileSide,this.tileSide);var d=this.session.state.grid[b][a];if(0!==d){var e=this.session.state.selected.x===a&&this.session.state.selected.y===b;this.drawPiece(d,a+1,b+1,e)}}},Board.prototype.drawPiece=function(a,b,c,d){var e=.9*this.tileSide/2,f={x:b*this.tileSide-this.tileSide/2,y:c*this.tileSide-this.tileSide/2},g=a>8?colors.player2:colors.player1,h=colors[pieceNumberColors[(a-1)%8]];this.ctx.beginPath(),this.ctx.arc(f.x,f.y,e,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fillStyle=g,this.ctx.fill(),this.ctx.strokeStyle=g,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(f.x,f.y,.75*e,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fillStyle=h,this.ctx.fill(),this.ctx.strokeStyle=h,this.ctx.stroke(),d&&(this.ctx.beginPath(),this.ctx.arc(f.x,f.y,.5*e,0,2*Math.PI,!1),this.ctx.fillStyle=g,this.ctx.fill(),this.ctx.strokeStyle=g,this.ctx.stroke())},Board.prototype.colorForPos=function(a,b){return this.tileColor[b-1][a-1]},Board.prototype.addContextEvent=function(a,b){this.ctx.canvas.addEventListener(a,b)},Board.prototype.tileAt=function(a){return{x:Math.floor(a.x/this.tileSide),y:Math.floor(a.y/this.tileSide)}},Board.prototype.clicked=function(a){var b=this.tileAt(a),c=this.session.state.selected.y,d=this.session.state.selected.x;this.session.state.selected.x===b.x&&this.session.state.selected.y===b.y?(this.session.state.selected.x=-1,this.session.state.selected.y=-1):(this.session.state.grid[b.y][b.x]>0&&(this.session.state.selected.x=b.x,this.session.state.selected.y=b.y),0===this.session.state.grid[b.y][b.x]&&(this.session.state.grid[b.y][b.x]=this.session.state.grid[c][d],this.session.state.grid[c][d]=0)),this.session.save()},Board.prototype.resetGame=function(){this.session.resetGame(),this.draw()},function(){init()}();