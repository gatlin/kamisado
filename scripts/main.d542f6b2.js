"use strict";!function(){function a(b,c){return c||(c={}),function(d){if(c[d])return c[d];var e=b(function(d){return a(b,c)(d)})(d);return c[d]=e,e}}function b(a){var b,c=!1;return function(){return c?b:(c=!0,b=a())}}function c(a){return function(){return a}}function d(a){return a}function e(a,b){return function(c){return a(b(c))}}function f(){}function g(){}function h(){}function i(a){return b(function(){return a.extract()(a.extend(function(a){return i(a)}))})}function j(a){this.start=b(a)}function k(a){a.forEach(function(a){a.start()})}function l(a,b){this.array="undefined"!=typeof a?a:[],this.index="undefined"!=typeof b?b:0}function m(a,c){this.fst=b(function(){return a}),this.snd=b(function(){return c})}function n(a,c){"undefined"!=typeof a&&(this.headV=a),this.nextF=b("undefined"!=typeof c?c:function(){return new n})}function o(a,c,d){this.focus=function(){return c},this.streamL=b("undefined"!=typeof a?function(){return a}:function(){return new n}),this.streamR=b("undefined"!=typeof d?function(){return d}:function(){return new n})}function p(a,c){this.lookup=a,this.index=b(function(){return c})}function q(a){this.fn=a}var r=function(a){return function(b){return a(function(a){return b(b)(a)})}(function(b){return a(function(a){return b(b)(a)})})};f.prototype.force=function(){return this.map(function(a){return a()})},f.prototype.delay=function(){return this.map(function(a){return function(){return a}})},g.prototype.chain=function(a){return this.map(a).flatten()},h.prototype.extend=function(a){return this.duplicate().map(a)},h.prototype.evaluate=function(){var a=this;return b(function(){return function(b){return a.ap(b.duplicate())}(a)})()},j.of=function(a){return new j(function(){return a})},j.prototype.chain=function(a){var b=this;return new j(function(){return a(b.start()).start()})},j.prototype.map=function(a){var b=this;return new j(function(){return a(b.start())})},j.prototype.fork=function(){var a=this;return new j(function(){setTimeout(function(){a.start()},0)})},j.prototype.extract=function(){return this.start()},j.prototype.duplicate=function(){var a=this;return this.map(function(){return j.of(a)})},j.prototype.extend=h.prototype.extend,Function.prototype.map=function(a){var b=this;return function(c){return a(b(c))}},Function.prototype.force=f.prototype.force,Function.prototype.delay=f.prototype.delay,Function.of=c,Function.prototype.flatten=function(){var a=this;return function(b){var c=JSON.parse(JSON.stringify(b)),d=a(b);return d(c)}},Function.prototype.chain=g.prototype.chain,Function.prototype.read=function(a){var b=this;return b.chain(function(b){return function(c){return a(c,b)}})},Function.prototype.extract=function(){return this([])},Function.prototype.duplicate=function(){var a=this;return function(b){return function(c){return a(c.concat(b))}}},Function.prototype.extend=h.prototype.extend,Array.of||(Array.of=function(){return Array.prototype.slice.call(arguments)}),Array.prototype.force=f.prototype.force,Array.prototype.delay=f.prototype.delay,Array.prototype.zipWith=function(a,b){for(var c=this.length<a.length?this.length:a.length,d=new Array(c),e=0;c>e;e++)d[e]=b(this[e],a[e]);return d},Array.prototype.flatten=function(){return this.reduce(function(a,b){return a.concat(b)},[])},Array.prototype.chain=g.prototype.chain,Array.prototype.ap=function(a){return this.zipWith(a,function(a,b){return function(){return a(b)}})},l.prototype.show=function(){var a="[",b=this.array.reduce(function(a,b){return a+" "+b.toString()}," ");return a+b+" ]"},l.prototype.map=function(a){return new l(this.array.map(a),this.index)},l.prototype.force=f.prototype.force,l.prototype.delay=f.prototype.delay,l.prototype.extract=function(){return this.array[this.index]},l.prototype.duplicate=function(){for(var a=[],b=this,c=0;c<this.array.length;c++)a[c]=new l(b.array,c);return new l(a,b.index)},l.prototype.extend=h.prototype.extend,l.prototype.ap=function(a){return this.extend(function(c){return b(function(){return c.extract()(a.at(c.index))})})},l.prototype.evaluate=function(){return this.extend(i)},l.prototype.setIndex=function(a){return this.index=a,this},l.prototype.at=function(a){return this.array[a]},m.prototype.map=function(a){return new m(this.fst(),a(this.snd()))},m.prototype.force=f.prototype.force,m.prototype.delay=f.prototype.delay,m.prototype.extract=function(){return this.snd()},m.prototype.duplicate=function(){var a=this.fst(),b=this;return new m(a,b)},m.prototype.extend=h.prototype.extend,m.prototype.evaluate=function(){return this.extend(i)},m.of=function(a){return new m([],a)},m.prototype.flatten=function(){var a=this,b=this.snd();return new m(a.fst().concat(b.fst()),b.snd())},m.prototype.chain=g.prototype.chain,m.prototype.log=function(a){var b=this;return b.chain(function(b){return new m(a(b),b)})},m.prototype["yield"]=function(){var a=this;return a.chain(function(a){return new m(function(b){return b(a)},a)})},n.prototype.show=function(){return""+this.head()+" ..."},n.make=function(){if(0===arguments.length)return new n;var a=Array.prototype.slice.call(arguments,1);return new n(arguments[0],function(){return n.make.apply(null,a)})},n.repeat=function(a){return new n(a,function(){return n.repeat(a)})},n.prototype.head=function(){return this.headV},n.prototype.tail=function(){return this.nextF()},n.prototype.empty=function(){return"undefined"==typeof this.headV},n.prototype.map=function(a){if(this.empty())return this;var b=this;return new n(a(this.headV),function(){return b.tail().map(a)})},n.prototype.force=f.prototype.force,n.prototype.delay=f.prototype.delay,n.prototype.reduce=function(a,b){for(var c=this,d=b;!c.empty();)d=a(d,c.headV),c=c.tail();return d},n.prototype.filter=function(a){if(this.empty())return this;var b=this.headV,c=this.tail();return a(b)?new n(b,function(){return c.filter(a)}):c.filter(a)},n.prototype.ap=function(a){if(this.empty()||a.empty())return new n;var b=this,c=this.extract(),d=a.extract(),e=a.tail(),f=b.tail();return new n(c(d),function(){return f.ap(e)})},n.prototype.take=function(a){if(this.empty())return this;if(0===a)return new n;var b=this;return new n(this.headV,function(){return b.tail().take(a-1)})},n.prototype.length=function(){for(var a=this,b=0;!a.empty();)++b,a=a.tail();return b},n.prototype.toArray=function(){for(var a=[],b=this;!b.empty();)a.push(b.extract()),b=b.tail();return a},n.unfold=function(a,b){return new n(b,function(){return n.unfold(a,a(b))})},n.of=function(a){return n.repeat(a)},n.prototype.flatten=function(){return this.map(function(a){return a.head()})},n.prototype.chain=g.prototype.chain,n.prototype.extract=n.prototype.head,n.prototype.duplicate=function(){return this.map(function(a){return new n(a)})},n.prototype.extend=h.prototype.extend,n.prototype.evaluate=h.prototype.evaluate,n.fromArray=function(a){return 0===a.length?new n:new n(a[0],function(){return n.fromArray(a.slice(1))})},o.prototype.map=function(a){var b=this;return new o(b.streamL().map(a),a(b.focus()),b.streamR().map(a))},o.prototype.force=f.prototype.force,o.prototype.delay=f.prototype.delay,o.prototype.shiftR=function(){var a=this,b=a.streamR().extract(),c=a.streamR().tail(),d=new n(a.focus(),function(){return a.streamL()});return new o(d,b,c)},o.prototype.shiftL=function(){var a=this,b=a.streamL().extract(),c=a.streamL().tail(),d=new n(a.focus(),function(){return a.streamR()});return new o(c,b,d)},o.unfold=function(a,b,c,d){return new o(n.unfold(a,d),b(d),n.unfold(c,d))},o.iterate=function(a,b,c){return o.unfold(a,d,b,c)},o.prototype.extract=function(){return this.focus()},o.prototype.duplicate=function(){var a=this;return o.iterate(function(a){return a.shiftL()},function(a){return a.shiftR()},a)},o.prototype.extend=h.prototype.extend,o.prototype.evaluate=h.prototype.evaluate,o.prototype.ap=function(a){var b=this;return new o(b.streamL().ap(a.streamL()),b.extract()(a.extract()),b.streamR().ap(a.streamR()))},o.prototype.insert=function(a){var b=this;return new o(b.streamL(),a,b.streamR())},o.prototype.slice=function(a,b){var c=this.streamL().take(a).toArray().reverse(),d=this.streamR().take(b).toArray();return c.concat(this.focus()).concat(d)},p.prototype.seek=function(a){return new p(this.lookup,a)},p.prototype.peek=function(a){return this.lookup(a)},p.prototype.map=function(a){return new p(e(a,this.lookup),this.index())},p.prototype.force=f.prototype.force,p.prototype.delay=f.prototype.delay,p.prototype.extract=function(){return this.lookup(this.index())},p.prototype.duplicate=function(){var a=this;return new p(a.lookup,new p(a.lookup,a.index()))},p.prototype.extend=h.prototype.extend,q.prototype.map=function(a){return this.fn=this.fn.map(a),this},q.prototype.force=f.prototype.force,q.prototype.delay=f.prototype.delay,q.prototype.extract=function(){return this.fn.extract()},q.prototype.duplicate=function(){return this.fn=this.fn.duplicate(),this},q.prototype.extend=h.prototype.extend,q.prototype.send=function(a){return this.fn=this.fn.extend(function(b){return b([a])}),this};var s={Monad:g,Comonad:h,IO:j,sequence:k,fix:a,memothunk:b,id:d,compose:e,constant:c,Cursor:l,Stream:n,Tape:o,Array:Array,Functor:f,Pair:m,Store:p,Y:r,wfix:i,Function:Function,Sink:q};if("undefined"!=typeof module&&"undefined"!=typeof module.exports)module.exports=s;else for(var t in s)window[t]=s[t]}(),function(){function a(b,c){return c||(c={}),function(d){if(c[d])return c[d];var e=b(function(d){return a(b,c)(d)})(d);return c[d]=e,e}}function b(a){var b,c=!1;return function(){return c?b:(c=!0,b=a())}}function c(a){return function(){return a}}function d(a){return a}function e(a,b){return function(c){return a(b(c))}}function f(){}function g(){}function h(){}function i(a){return b(function(){return a.extract()(a.extend(function(a){return i(a)}))})}function j(a){this.start=b(a)}function k(a){a.forEach(function(a){a.start()})}function l(a,b){this.array="undefined"!=typeof a?a:[],this.index="undefined"!=typeof b?b:0}function m(a,c){this.fst=b(function(){return a}),this.snd=b(function(){return c})}function n(a,c){"undefined"!=typeof a&&(this.headV=a),this.nextF=b("undefined"!=typeof c?c:function(){return new n})}function o(a,c,d){this.focus=function(){return c},this.streamL=b("undefined"!=typeof a?function(){return a}:function(){return new n}),this.streamR=b("undefined"!=typeof d?function(){return d}:function(){return new n})}function p(a,c){this.lookup=a,this.index=b(function(){return c})}function q(a){this.fn=a}var r=function(a){return function(b){return a(function(a){return b(b)(a)})}(function(b){return a(function(a){return b(b)(a)})})};f.prototype.force=function(){return this.map(function(a){return a()})},f.prototype.delay=function(){return this.map(function(a){return function(){return a}})},g.prototype.chain=function(a){return this.map(a).flatten()},h.prototype.extend=function(a){return this.duplicate().map(a)},h.prototype.evaluate=function(){var a=this;return b(function(){return function(b){return a.ap(b.duplicate())}(a)})()},j.of=function(a){return new j(function(){return a})},j.prototype.chain=function(a){var b=this;return new j(function(){return a(b.start()).start()})},j.prototype.map=function(a){var b=this;return new j(function(){return a(b.start())})},j.prototype.fork=function(){var a=this;return new j(function(){setTimeout(function(){a.start()},0)})},j.prototype.extract=function(){return this.start()},j.prototype.duplicate=function(){var a=this;return this.map(function(){return j.of(a)})},j.prototype.extend=h.prototype.extend,Function.prototype.map=function(a){var b=this;return function(c){return a(b(c))}},Function.prototype.force=f.prototype.force,Function.prototype.delay=f.prototype.delay,Function.of=c,Function.prototype.flatten=function(){var a=this;return function(b){var c=JSON.parse(JSON.stringify(b)),d=a(b);return d(c)}},Function.prototype.chain=g.prototype.chain,Function.prototype.read=function(a){var b=this;return b.chain(function(b){return function(c){return a(c,b)}})},Function.prototype.extract=function(){return this([])},Function.prototype.duplicate=function(){var a=this;return function(b){return function(c){return a(c.concat(b))}}},Function.prototype.extend=h.prototype.extend,Array.of||(Array.of=function(){return Array.prototype.slice.call(arguments)}),Array.prototype.force=f.prototype.force,Array.prototype.delay=f.prototype.delay,Array.prototype.zipWith=function(a,b){for(var c=this.length<a.length?this.length:a.length,d=new Array(c),e=0;c>e;e++)d[e]=b(this[e],a[e]);return d},Array.prototype.flatten=function(){return this.reduce(function(a,b){return a.concat(b)},[])},Array.prototype.chain=g.prototype.chain,Array.prototype.ap=function(a){return this.zipWith(a,function(a,b){return function(){return a(b)}})},l.prototype.show=function(){var a="[",b=this.array.reduce(function(a,b){return a+" "+b.toString()}," ");return a+b+" ]"},l.prototype.map=function(a){return new l(this.array.map(a),this.index)},l.prototype.force=f.prototype.force,l.prototype.delay=f.prototype.delay,l.prototype.extract=function(){return this.array[this.index]},l.prototype.duplicate=function(){for(var a=[],b=this,c=0;c<this.array.length;c++)a[c]=new l(b.array,c);return new l(a,b.index)},l.prototype.extend=h.prototype.extend,l.prototype.ap=function(a){return this.extend(function(c){return b(function(){return c.extract()(a.at(c.index))})})},l.prototype.evaluate=function(){return this.extend(i)},l.prototype.setIndex=function(a){return this.index=a,this},l.prototype.at=function(a){return this.array[a]},m.prototype.map=function(a){return new m(this.fst(),a(this.snd()))},m.prototype.force=f.prototype.force,m.prototype.delay=f.prototype.delay,m.prototype.extract=function(){return this.snd()},m.prototype.duplicate=function(){var a=this.fst(),b=this;return new m(a,b)},m.prototype.extend=h.prototype.extend,m.prototype.evaluate=function(){return this.extend(i)},m.of=function(a){return new m([],a)},m.prototype.flatten=function(){var a=this,b=this.snd();return new m(a.fst().concat(b.fst()),b.snd())},m.prototype.chain=g.prototype.chain,m.prototype.log=function(a){var b=this;return b.chain(function(b){return new m(a(b),b)})},m.prototype["yield"]=function(){var a=this;return a.chain(function(a){return new m(function(b){return b(a)},a)})},n.prototype.show=function(){return""+this.head()+" ..."},n.make=function(){if(0===arguments.length)return new n;var a=Array.prototype.slice.call(arguments,1);return new n(arguments[0],function(){return n.make.apply(null,a)})},n.repeat=function(a){return new n(a,function(){return n.repeat(a)})},n.prototype.head=function(){return this.headV},n.prototype.tail=function(){return this.nextF()},n.prototype.empty=function(){return"undefined"==typeof this.headV},n.prototype.map=function(a){if(this.empty())return this;var b=this;return new n(a(this.headV),function(){return b.tail().map(a)})},n.prototype.force=f.prototype.force,n.prototype.delay=f.prototype.delay,n.prototype.reduce=function(a,b){for(var c=this,d=b;!c.empty();)d=a(d,c.headV),c=c.tail();return d},n.prototype.filter=function(a){if(this.empty())return this;var b=this.headV,c=this.tail();return a(b)?new n(b,function(){return c.filter(a)}):c.filter(a)},n.prototype.ap=function(a){if(this.empty()||a.empty())return new n;var b=this,c=this.extract(),d=a.extract(),e=a.tail(),f=b.tail();return new n(c(d),function(){return f.ap(e)})},n.prototype.take=function(a){if(this.empty())return this;if(0===a)return new n;var b=this;return new n(this.headV,function(){return b.tail().take(a-1)})},n.prototype.length=function(){for(var a=this,b=0;!a.empty();)++b,a=a.tail();return b},n.prototype.toArray=function(){for(var a=[],b=this;!b.empty();)a.push(b.extract()),b=b.tail();return a},n.unfold=function(a,b){return new n(b,function(){return n.unfold(a,a(b))})},n.of=function(a){return n.repeat(a)},n.prototype.flatten=function(){return this.map(function(a){return a.head()})},n.prototype.chain=g.prototype.chain,n.prototype.extract=n.prototype.head,n.prototype.duplicate=function(){return this.map(function(a){return new n(a)})},n.prototype.extend=h.prototype.extend,n.prototype.evaluate=h.prototype.evaluate,n.fromArray=function(a){return 0===a.length?new n:new n(a[0],function(){return n.fromArray(a.slice(1))})},o.prototype.map=function(a){var b=this;return new o(b.streamL().map(a),a(b.focus()),b.streamR().map(a))},o.prototype.force=f.prototype.force,o.prototype.delay=f.prototype.delay,o.prototype.shiftR=function(){var a=this,b=a.streamR().extract(),c=a.streamR().tail(),d=new n(a.focus(),function(){return a.streamL()});return new o(d,b,c)},o.prototype.shiftL=function(){var a=this,b=a.streamL().extract(),c=a.streamL().tail(),d=new n(a.focus(),function(){return a.streamR()});return new o(c,b,d)},o.unfold=function(a,b,c,d){return new o(n.unfold(a,d),b(d),n.unfold(c,d))},o.iterate=function(a,b,c){return o.unfold(a,d,b,c)},o.prototype.extract=function(){return this.focus()},o.prototype.duplicate=function(){var a=this;return o.iterate(function(a){return a.shiftL()},function(a){return a.shiftR()},a)},o.prototype.extend=h.prototype.extend,o.prototype.evaluate=h.prototype.evaluate,o.prototype.ap=function(a){var b=this;return new o(b.streamL().ap(a.streamL()),b.extract()(a.extract()),b.streamR().ap(a.streamR()))},o.prototype.insert=function(a){var b=this;return new o(b.streamL(),a,b.streamR())},o.prototype.slice=function(a,b){var c=this.streamL().take(a).toArray().reverse(),d=this.streamR().take(b).toArray();return c.concat(this.focus()).concat(d)},p.prototype.seek=function(a){return new p(this.lookup,a)},p.prototype.peek=function(a){return this.lookup(a)},p.prototype.map=function(a){return new p(e(a,this.lookup),this.index())},p.prototype.force=f.prototype.force,p.prototype.delay=f.prototype.delay,p.prototype.extract=function(){return this.lookup(this.index())},p.prototype.duplicate=function(){var a=this;return new p(a.lookup,new p(a.lookup,a.index()))},p.prototype.extend=h.prototype.extend,q.prototype.map=function(a){return this.fn=this.fn.map(a),this},q.prototype.force=f.prototype.force,q.prototype.delay=f.prototype.delay,q.prototype.extract=function(){return this.fn.extract()},q.prototype.duplicate=function(){return this.fn=this.fn.duplicate(),this},q.prototype.extend=h.prototype.extend,q.prototype.send=function(a){return this.fn=this.fn.extend(function(b){return b([a])}),this};var s={Monad:g,Comonad:h,IO:j,sequence:k,fix:a,memothunk:b,id:d,compose:e,constant:c,Cursor:l,Stream:n,Tape:o,Array:Array,Functor:f,Pair:m,Store:p,Y:r,wfix:i,Function:Function,Sink:q};if("undefined"!=typeof module&&"undefined"!=typeof module.exports)module.exports=s;else for(var t in s)window[t]=s[t]}(),function(){function a(a,b){return b>a?a:b}function b(){var a=location.hash.slice(1);return""===a&&(a=t(),location.hash="#"+a),a}function c(a,b){this.x=a,this.y=b}function d(a,b){var d=a.getBoundingClientRect();return new c(b.clientX-d.left,b.clientY-d.top)}function e(a,b,c,d,e){this.grid=a,this.pos=b,this.selected="undefined"!=typeof d?d:null,this.player="undefined"!=typeof e?e:0,this.gameId="undefined"!=typeof c?c:"test-game"}function f(a){return new IO(function(){var b=a.extract(),c=r[s[a.pos.y][a.pos.x]];if(n.fillStyle=c,n.fillRect(a.pos.x*i,a.pos.y*i,i,i),0===b)return b;var d=a.pos.x+1,e=a.pos.y+1,f={x:d*i-i/2,y:e*i-i/2},g=b>q?r[9]:r[8],h=r[(b-1)%8];return n.beginPath(),n.arc(f.x,f.y,j,0,2*Math.PI,!1),n.closePath(),n.fillStyle=g,n.fill(),n.strokeStyle=g,n.stroke(),n.beginPath(),n.arc(f.x,f.y,.75*j,0,2*Math.PI,!1),n.closePath(),n.fillStyle=h,n.fill(),n.strokeStyle=h,n.stroke(),null!==a.selected&&a.selected.x===a.pos.x&&a.selected.y===a.pos.y&&(n.beginPath(),n.arc(f.x,f.y,.5*j,0,2*Math.PI,!1),n.fillStyle=g,n.fill(),n.strokeStyle=g,n.stroke()),b}).start()}function g(){return new IO(function(){var a=b(),d=JSON.parse(localStorage.getItem(a));if(null===d){var f,g=[];for(f=1;q-1>f;f++)g[f]=[].repeat(0,8);return g[0]=[1,2,3,4,5,6,7,8],g[7]=[16,15,14,13,12,11,10,9],new e(g,new c(0,0),a)}return new e(d.grid,new c(0,0),d.gameId,d.selected,d.player)})}function h(a){return new IO(function(){n.canvas.addEventListener("click",function(b){var c=d(this,b);c.x=Math.floor(c.x/i),c.y=Math.floor(c.y/i),a.clicked(c).drawCells()}),document.getElementById("new-game").addEventListener("click",function(){location.hash="",location.reload()})})}var i,j,k,l,m=document.getElementById("board"),n=m.getElementsByTagName("canvas")[0].getContext("2d"),o=window.innerWidth,p=window.innerHeight-50,q=8,r=["#F5B437","#3340AE","#1E8AD1","#F8D6C4","#F6E500","#DC442F","#BAD360","#6B451E","#080D07","#F4FFF4"],s=[[0,1,2,3,4,5,6,7],[5,0,3,6,1,4,7,2],[6,3,0,5,2,7,4,1],[3,2,1,0,7,6,5,4],[4,5,6,7,0,1,2,3],[1,4,7,2,5,0,3,6],[2,7,4,1,6,3,0,5],[7,6,5,4,3,2,1,0]];Array.prototype.repeat=function(a,b){for(;b;)this[--b]=a;return this};var t=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();e.prototype.save=function(){var a={grid:this.grid,player:this.player,gameId:this.gameId,selected:this.selected};localStorage.setItem(this.gameId,JSON.stringify(a))},e.prototype.updatePos=function(a){return this.pos=a,this},e.prototype.extract=function(){return this.grid[this.pos.y][this.pos.x]},e.prototype.duplicate=function(){var a,b,d=this,f=this.grid,g=[];for(b=0;b<d.grid.length;b++)for(g[b]=[],a=0;a<d.grid[b].length;a++)g[b][a]=new e(f,new c(a,b),d.gameId,d.selected,d.player);return this.grid=g,this},e.prototype.map=function(a){var b,c,d=[],e=this;for(c=0;c<e.grid.length;c++)for(d[c]=[],b=0;b<e.grid[c].length;b++)d[c][b]=a(e.grid[c][b]);return this.grid=d,this},e.prototype.extend=Comonad.prototype.extend,e.prototype.drawCells=function(){return this.extend(f)},e.prototype.legalMove=function(){return(this.player?this.selected.y>this.pos.y:this.selected.y<this.pos.y)&&0===this.extract()&&(Math.abs(this.selected.x-this.pos.x)===Math.abs(this.selected.y-this.pos.y)||this.selected.x-this.pos.x===0)},e.prototype.clicked=function(a){var b=this.updatePos(a).extract();if(null===this.selected&&(this.selected=new c(-1,-1)),this.selected.x===this.pos.x&&this.selected.y===this.pos.y)return this.player=this.player?0:1,this.selectNextPiece(),this;if(b>0&&(this.selected=this.pos),0===b){if(!this.legalMove())return this;this.grid[this.pos.y][this.pos.x]=this.grid[this.selected.y][this.selected.x],this.grid[this.selected.y][this.selected.x]=0,this.selected.x=this.pos.x,this.selected.y=this.pos.y,this.player=this.player?0:1}return this.selectNextPiece(),this.save(),this},e.prototype.selectNextPiece=function(){var a,b,c,d=s[this.selected.y][this.selected.x],e=d+1+8*this.player;for(b=0;b<this.grid.length;b++)for(a=0;a<this.grid[b].length;a++)if(c=this.grid[b][a],c===e){this.selected.x=a,this.selected.y=b;break}},k=new IO(function(){n.canvas.width=.9*a(o,p),n.canvas.height=n.canvas.width,i=.9*a(o,p)/q,j=.9*i/2}),l=k.chain(g).chain(function(a){return IO.of(a.drawCells())}).chain(h),l.start()}(),function(){function a(a,b){return b>a?a:b}function b(){var a=location.hash.slice(1);return""===a&&(a=t(),location.hash="#"+a),a}function c(a,b){this.x=a,this.y=b}function d(a,b){var d=a.getBoundingClientRect();return new c(b.clientX-d.left,b.clientY-d.top)}function e(a,b,c,d,e){this.grid=a,this.pos=b,this.selected="undefined"!=typeof d?d:null,this.player="undefined"!=typeof e?e:0,this.gameId="undefined"!=typeof c?c:"test-game"}function f(a){return new IO(function(){var b=a.extract(),c=r[s[a.pos.y][a.pos.x]];if(n.fillStyle=c,n.fillRect(a.pos.x*i,a.pos.y*i,i,i),0===b)return b;var d=a.pos.x+1,e=a.pos.y+1,f={x:d*i-i/2,y:e*i-i/2},g=b>q?r[9]:r[8],h=r[(b-1)%8];return n.beginPath(),n.arc(f.x,f.y,j,0,2*Math.PI,!1),n.closePath(),n.fillStyle=g,n.fill(),n.strokeStyle=g,n.stroke(),n.beginPath(),n.arc(f.x,f.y,.75*j,0,2*Math.PI,!1),n.closePath(),n.fillStyle=h,n.fill(),n.strokeStyle=h,n.stroke(),null!==a.selected&&a.selected.x===a.pos.x&&a.selected.y===a.pos.y&&(n.beginPath(),n.arc(f.x,f.y,.5*j,0,2*Math.PI,!1),n.fillStyle=g,n.fill(),n.strokeStyle=g,n.stroke()),b}).start()}function g(){return new IO(function(){var a=b(),d=JSON.parse(localStorage.getItem(a));if(null===d){var f,g=[];for(f=1;q-1>f;f++)g[f]=[].repeat(0,8);return g[0]=[1,2,3,4,5,6,7,8],g[7]=[16,15,14,13,12,11,10,9],new e(g,new c(0,0),a)}return new e(d.grid,new c(0,0),d.gameId,d.selected,d.player)})}function h(a){return new IO(function(){n.canvas.addEventListener("click",function(b){var c=d(this,b);c.x=Math.floor(c.x/i),c.y=Math.floor(c.y/i),a.clicked(c).drawCells()}),document.getElementById("new-game").addEventListener("click",function(){location.hash="",location.reload()})})}var i,j,k,l,m=document.getElementById("board"),n=m.getElementsByTagName("canvas")[0].getContext("2d"),o=window.innerWidth,p=window.innerHeight-50,q=8,r=["#F5B437","#3340AE","#1E8AD1","#F8D6C4","#F6E500","#DC442F","#BAD360","#6B451E","#080D07","#F4FFF4"],s=[[0,1,2,3,4,5,6,7],[5,0,3,6,1,4,7,2],[6,3,0,5,2,7,4,1],[3,2,1,0,7,6,5,4],[4,5,6,7,0,1,2,3],[1,4,7,2,5,0,3,6],[2,7,4,1,6,3,0,5],[7,6,5,4,3,2,1,0]];Array.prototype.repeat=function(a,b){for(;b;)this[--b]=a;return this};var t=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();e.prototype.save=function(){var a={grid:this.grid,player:this.player,gameId:this.gameId,selected:this.selected};localStorage.setItem(this.gameId,JSON.stringify(a))},e.prototype.updatePos=function(a){return this.pos=a,this},e.prototype.extract=function(){return this.grid[this.pos.y][this.pos.x]},e.prototype.duplicate=function(){var a,b,d=this,f=this.grid,g=[];for(b=0;b<d.grid.length;b++)for(g[b]=[],a=0;a<d.grid[b].length;a++)g[b][a]=new e(f,new c(a,b),d.gameId,d.selected,d.player);return this.grid=g,this},e.prototype.map=function(a){var b,c,d=[],e=this;for(c=0;c<e.grid.length;c++)for(d[c]=[],b=0;b<e.grid[c].length;b++)d[c][b]=a(e.grid[c][b]);return this.grid=d,this},e.prototype.extend=Comonad.prototype.extend,e.prototype.drawCells=function(){return this.extend(f)},e.prototype.legalMove=function(){return(this.player?this.selected.y>this.pos.y:this.selected.y<this.pos.y)&&0===this.extract()&&(Math.abs(this.selected.x-this.pos.x)===Math.abs(this.selected.y-this.pos.y)||this.selected.x-this.pos.x===0)},e.prototype.clicked=function(a){var b=this.updatePos(a).extract();if(null===this.selected&&(this.selected=new c(-1,-1)),this.selected.x===this.pos.x&&this.selected.y===this.pos.y)return this.player=this.player?0:1,this.selectNextPiece(),this;if(b>0&&(this.selected=this.pos),0===b){if(!this.legalMove())return this;this.grid[this.pos.y][this.pos.x]=this.grid[this.selected.y][this.selected.x],this.grid[this.selected.y][this.selected.x]=0,this.selected.x=this.pos.x,this.selected.y=this.pos.y,this.player=this.player?0:1}return this.selectNextPiece(),this.save(),this},e.prototype.selectNextPiece=function(){var a,b,c,d=s[this.selected.y][this.selected.x],e=d+1+8*this.player;for(b=0;b<this.grid.length;b++)for(a=0;a<this.grid[b].length;a++)if(c=this.grid[b][a],c===e){this.selected.x=a,this.selected.y=b;break}},k=new IO(function(){n.canvas.width=.9*a(o,p),n.canvas.height=n.canvas.width,i=.9*a(o,p)/q,j=.9*i/2}),l=k.chain(g).chain(function(a){return IO.of(a.drawCells())}).chain(h),l.start()}();