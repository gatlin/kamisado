!function(){"use strict";function a(a,b){return b>a?a:b}function b(a,b){this.x=a,this.y=b}function c(a,c){var d=a.getBoundingClientRect();return new b(c.clientX-d.left,c.clientY-d.top)}function d(a,b,c,d){this.board=a,this.pos=b,this.selected="undefined"!=typeof c?c:null,this.player="undefined"!=typeof d?d:0}function e(a){var b=t[a.selected.y][a.selected.x],c=b+1+8*a.player,d=a.pos.x,e=a.pos.y,f=a.extract();return f===c&&(a.selected.x=d,a.selected.y=e),f}function f(a){this.unsafePerformIO=a}function g(){return new f(function(){var a,c=[];for(a=1;r-1>a;a++)c[a]=[].repeat(0,8);return c[0]=[1,2,3,4,5,6,7,8],c[7]=[16,15,14,13,12,11,10,9],new d(c,new b(0,0))})}function h(a){var b=a.extract(),c=s[t[a.pos.y][a.pos.x]];if(o.fillStyle=c,o.fillRect(a.pos.x*j,a.pos.y*j,j,j),0===b)return b;var d=a.pos.x+1,e=a.pos.y+1,f={x:d*j-j/2,y:e*j-j/2},g=b>r?s[9]:s[8],h=s[(b-1)%8];return o.beginPath(),o.arc(f.x,f.y,k,0,2*Math.PI,!1),o.closePath(),o.fillStyle=g,o.fill(),o.strokeStyle=g,o.stroke(),o.beginPath(),o.arc(f.x,f.y,.75*k,0,2*Math.PI,!1),o.closePath(),o.fillStyle=h,o.fill(),o.strokeStyle=h,o.stroke(),null!==a.selected&&a.selected.x===a.pos.x&&a.selected.y===a.pos.y&&(o.beginPath(),o.arc(f.x,f.y,.5*k,0,2*Math.PI,!1),o.fillStyle=g,o.fill(),o.strokeStyle=g,o.stroke()),b}function i(a){return new f(function(){o.canvas.addEventListener("click",function(b){var d=c(this,b);d.x=Math.floor(d.x/j),d.y=Math.floor(d.y/j),a.clicked(d).extend(e).drawCells()})})}var j,k,l,m,n=document.getElementById("board"),o=n.getElementsByTagName("canvas")[0].getContext("2d"),p=window.innerWidth,q=window.innerHeight,r=8,s=["#F5B437","#3340AE","#1E8AD1","#F8D6C4","#F6E500","#DC442F","#BAD360","#6B451E","#080D07","#F4FFF4"],t=[[0,1,2,3,4,5,6,7],[5,0,3,6,1,4,7,2],[6,3,0,5,2,7,4,1],[3,2,1,0,7,6,5,4],[4,5,6,7,0,1,2,3],[1,4,7,2,5,0,3,6],[2,7,4,1,6,3,0,5],[7,6,5,4,3,2,1,0]];Array.prototype.repeat=function(a,b){for(;b;)this[--b]=a;return this},d.prototype.updatePos=function(a){return this.pos=a,this},d.prototype.extract=function(){return this.board[this.pos.y][this.pos.x]},d.prototype.extend=function(a){var c,e,f=[];for(e=0;e<this.board.length;e++)for(f[e]=[],c=0;c<this.board[e].length;c++)f[e][c]=a(new d(this.board,new b(c,e),this.selected,this.player));return this.board=f,this},d.prototype.drawCells=function(){return this.extend(h)},d.prototype.clicked=function(a){var c=this.updatePos(a).extract();return null===this.selected&&(this.selected=new b(-1,-1)),this.selected.x===a.x&&this.selected.y===a.y?this:(c>0&&(this.selected=a),0===c&&(this.board[a.y][a.x]=this.board[this.selected.y][this.selected.x],this.board[this.selected.y][this.selected.x]=0,this.selected=a,this.player=this.player?0:1,console.log("moved. switched to player "+this.player)),this)},f.of=function(a){return new f(function(){return a})},f.prototype.chain=function(a){var b=this;return new f(function(){return a(b.unsafePerformIO()).unsafePerformIO()})},f.prototype.fork=function(){var a=this;return new f(function(){setTimeout(function(){a.unsafePerformIO()},0)})},l=new f(function(){o.canvas.width=.9*a(p,q),o.canvas.height=o.canvas.width,j=.9*a(p,q)/r,k=.9*j/2}),m=l.chain(g).chain(function(a){return new f.of(a.drawCells())}).chain(i),m.unsafePerformIO()}();